CREATE  TABLE BMW_SALES_HISTORY (
    HISTORY_ID       NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DEALER_CODE        VARCHAR2(20) REFERENCES BMW_DEALERS(DEALER_CODE),
    MODEL_CODE         VARCHAR2(20) REFERENCES BMW_MODELS(MODEL_CODE),
    DATE_VALUE      DATE REFERENCES BMW_SALES_CALENDAR(DATE_VALUE),

    UNITS            NUMBER CHECK (UNITS >= 0),
    NET_PRICE        NUMBER(12,2) CHECK (NET_PRICE >= 0),
    CURRENCY         VARCHAR2(3) DEFAULT 'USD',
    DISCOUNT         NUMBER(12,2) CHECK (DISCOUNT >= 0),
    PROMO_FLAG       NUMBER(1) CHECK (PROMO_FLAG IN (0, 1)),
    INVENTORY_END    NUMBER CHECK (INVENTORY_END >= 0),
    BLACKOUT_FLAG    NUMBER(1) DEFAULT 0 CHECK (BLACKOUT_FLAG IN (0, 1))
);


CREATE TABLE BMW_SALES_HISTORY_REJECTS (
    LOAD_ID        NUMBER,
    ROW_NUM        NUMBER,
    DEALER_CODE    VARCHAR2(50),
    MODEL_CODE     VARCHAR2(50),
    ERROR_REASON   VARCHAR2(4000),
    RAW_ROW        CLOB,
    LOG_DATE       DATE DEFAULT SYSDATE
);

CREATE   TABLE BMW_FP_SCENARIOS (
    SCENARIO_ID      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    SCENARIO_NAME    VARCHAR2(200) NOT NULL,
    CREATED_BY       VARCHAR2(50),
    CREATED_DATE     DATE DEFAULT SYSDATE,

    STATUS           VARCHAR2(20) DEFAULT 'DRAFT' CHECK (STATUS IN ('DRAFT', 'SUBMITTED', 'APPROVED', 'REJECTED')) ,
    DESCRIPTION      VARCHAR2(1000)
);

CREATE   TABLE BMW_FP_SCENARIO_DRIVERS (
    DRIVER_ID        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    SCENARIO_ID      NUMBER REFERENCES BMW_FP_SCENARIOS(SCENARIO_ID),

    DEALER_ID        NUMBER NULL REFERENCES BMW_DEALERS(DEALER_ID),
    MODEL_ID         NUMBER NULL REFERENCES BMW_MODELS(MODEL_ID),

    PRICE_ELASTICITY NUMBER(5,2),     -- e.g., -0.8
    PROMO_UPLIFT     NUMBER(5,2),     -- e.g., +10% = 0.10
    INVENTORY_CAP    NUMBER,          -- maximum allowed inventory

    START_MONTH      DATE,
    END_MONTH        DATE
);

CREATE   TABLE BMW_AUDIT_LOG (
    AUDIT_ID         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USERNAME         VARCHAR2(50),
    ACTION_TYPE      VARCHAR2(50),
    TABLE_NAME       VARCHAR2(50),
    RECORD_ID        VARCHAR2(200),
    OLD_VALUE        CLOB,
    NEW_VALUE        CLOB,
    ACTION_DATE      DATE DEFAULT SYSDATE
);

CREATE   TABLE BMW_FORECAST_OUTPUT (
    FORECAST_ID      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    SCENARIO_ID      NUMBER REFERENCES BMW_FP_SCENARIOS(SCENARIO_ID),

    DEALER_ID        NUMBER REFERENCES BMW_DEALERS(DEALER_ID),
    MODEL_ID         NUMBER REFERENCES BMW_MODELS(MODEL_ID),
    CALENDAR_ID      NUMBER REFERENCES BMW_SALES_CALENDAR(CALENDAR_ID),

    FORECAST_UNITS   NUMBER,
    FORECAST_PRICE   NUMBER(12,2),
    FORECAST_REVENUE NUMBER(12,2),

    DAYS_TO_SELL     NUMBER,
    TURNOVER_RATE    NUMBER,
    AVG_DISCOUNT_PCT NUMBER(5,2)
);
